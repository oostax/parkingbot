# ParkingBot - Система для мониторинга парковок

## Описание

ParkingBot - это приложение для мониторинга парковок в Москве с функциями геймификации. Система включает в себя:
- Веб-интерфейс для просмотра парковок и статистики
- Telegram бот для быстрого доступа к информации
- Систему геймификации с достижениями и рейтингами
- Сервис сбора статистики о загруженности парковок

## Установка и настройка

### Требования
- Node.js 16+ 
- PM2 (для управления процессами)
- SQLite (база данных)

### Шаги установки

1. Клонировать репозиторий:
```
git clone https://github.com/pepsil1te/parkingbot.git
cd parkingbot
```

2. Установить зависимости:
```
npm install
```

3. Настроить переменные окружения:
```
npm run fix-env
```
или
```
node scripts/fix-env-variables.js
```

4. Настроить базу данных:
```
npm run fix-db
```
или
```
node scripts/fix-sqlite-permissions.js
```

5. Настроить Telegram бота:
```
npm run fix-bot
```
или
```
node scripts/fix-telegram-bot.js
```

6. Запустить приложение:
```
pm2 start ecosystem.config.js
```

### Автоматическое исправление всех проблем

Для автоматического исправления всех проблем с приложением выполните:
```
npm run fix-all
```
или
```
node scripts/fix-all.js
```

## Структура приложения

- `/src` - исходный код приложения
- `/prisma` - схема базы данных и миграции
- `/scripts` - вспомогательные скрипты для настройки
- `/public` - статические файлы
- `/telegram-bot` - код Telegram бота

## Управление процессами

Приложение использует PM2 для управления процессами:

- `nextjs-app` - веб-интерфейс (Next.js)
- `telegram-bot` - Telegram бот
- `stats-daemon` - сервис сбора статистики

Основные команды PM2:
```
pm2 list                  # Список всех процессов
pm2 restart all           # Перезапуск всех процессов
pm2 logs                  # Просмотр логов
pm2 logs [process-name]   # Просмотр логов конкретного процесса
```

## Устранение неполадок

### Проблемы с базой данных
Если возникают проблемы с базой данных SQLite, выполните:
```
node scripts/fix-sqlite-permissions.js
```

### Проблемы с Telegram ботом
Если Telegram бот не работает, проверьте токен и выполните:
```
node scripts/fix-telegram-bot.js
```

### Проблемы с переменными окружения
Для исправления переменных окружения выполните:
```
node scripts/fix-env-variables.js
```

### Полное исправление всех проблем
```
node scripts/fix-all.js
```
